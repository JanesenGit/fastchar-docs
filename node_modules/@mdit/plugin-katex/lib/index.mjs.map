{"version":3,"file":"index.mjs","sources":["../src/utils.ts","../src/plugin.ts"],"sourcesContent":["export const escapeHtml = (unsafeHTML: string): string =>\n  unsafeHTML\n    .replace(/&/gu, \"&amp;\")\n    .replace(/</gu, \"&lt;\")\n    .replace(/>/gu, \"&gt;\")\n    .replace(/\"/gu, \"&quot;\")\n    .replace(/'/gu, \"&#039;\");\n","import { createRequire } from \"node:module\";\n\nimport { tex } from \"@mdit/plugin-tex\";\nimport {\n  type default as Katex,\n  type KatexOptions as OriginalKatexOptions,\n} from \"katex\";\nimport type MarkdownIt from \"markdown-it\";\n\nimport { type KatexToken, type MarkdownItKatexOptions } from \"./options.js\";\nimport { escapeHtml } from \"./utils.js\";\n\nconst require = createRequire(import.meta.url);\n\nconst katexInline = (\n  tex: string,\n  katex: typeof Katex,\n  options: OriginalKatexOptions,\n  vPre: boolean,\n): string => {\n  try {\n    const result = katex.renderToString(tex, {\n      ...options,\n      displayMode: false,\n    });\n\n    return vPre\n      ? result.replace(/ class=\"katex\"/g, ' v-pre class=\"katex\"')\n      : result;\n  } catch (error) {\n    if (options.throwOnError) console.warn(error);\n\n    return `<span ${\n      vPre ? \"v-pre \" : \"\"\n    }class='katex-error' title='${escapeHtml(\n      (error as Error).toString(),\n    )}'>${escapeHtml(tex)}</span>`;\n  }\n};\n\nconst katexBlock = (\n  tex: string,\n  katex: typeof Katex,\n  options: OriginalKatexOptions,\n  vPre: boolean,\n): string => {\n  try {\n    return `<p ${\n      vPre ? \"v-pre \" : \"\"\n    }class='katex-block'>${katex.renderToString(tex, {\n      ...options,\n      displayMode: true,\n    })}</p>\\n`;\n  } catch (error) {\n    if (options.throwOnError) console.warn(error);\n\n    return `<p ${\n      vPre ? \"v-pre \" : \"\"\n    }class='katex-block katex-error' title='${escapeHtml(\n      (error as Error).toString(),\n    )}'>${escapeHtml(tex)}</p>\\n`;\n  }\n};\n\nexport const katex = <MarkdownItEnv = unknown>(\n  md: MarkdownIt,\n  options: MarkdownItKatexOptions<MarkdownItEnv> = {},\n): void => {\n  const {\n    allowInlineWithSpace = false,\n    mathFence = false,\n    mhchem = false,\n    logger = (errorCode: string): string =>\n      errorCode === \"newLineInDisplayMode\" ? \"ignore\" : \"warn\",\n    vPre = false,\n    ...userOptions\n  } = options;\n\n  try {\n    const katex = <typeof Katex>require(\"katex\");\n\n    if (mhchem) require(\"katex/contrib/mhchem\");\n\n    md.use(tex, {\n      allowInlineWithSpace,\n      mathFence,\n      render: (content: string, displayMode: boolean, env: MarkdownItEnv) => {\n        const katexOptions = {\n          strict: (\n            errorCode:\n              | \"unknownSymbol\"\n              | \"unicodeTextInMathMode\"\n              | \"mathVsTextUnits\"\n              | \"commentAtEnd\"\n              | \"htmlExtension\"\n              | \"newLineInDisplayMode\",\n            errorMsg: string,\n            token: KatexToken,\n          ): string => logger(errorCode, errorMsg, token, env) ?? \"ignore\",\n          throwOnError: false,\n          ...userOptions,\n        };\n\n        return displayMode\n          ? katexBlock(content, katex, katexOptions, vPre)\n          : katexInline(content, katex, katexOptions, vPre);\n      },\n    });\n  } catch (err) {\n    console.error('[@mdit/plugin-katex]: You should install \"katex\"!');\n  }\n};\n"],"names":["escapeHtml","unsafeHTML","require","createRequire","katexInline","tex","katex","options","vPre","result","error","katexBlock","md","allowInlineWithSpace","mathFence","mhchem","logger","errorCode","userOptions","content","displayMode","env","katexOptions","errorMsg","token"],"mappings":"mFAAa,MAAAA,EAAcC,GACzBA,EACG,QAAQ,MAAO,OAAO,EACtB,QAAQ,MAAO,MAAM,EACrB,QAAQ,MAAO,MAAM,EACrB,QAAQ,MAAO,QAAQ,EACvB,QAAQ,MAAO,QAAQ,ECMtBC,EAAUC,EAAc,YAAY,GAAG,EAEvCC,EAAc,CAClBC,EACAC,EACAC,EACAC,IACW,CACX,GAAI,CACF,MAAMC,EAASH,EAAM,eAAeD,EAAK,CACvC,GAAGE,EACH,YAAa,EACf,CAAC,EAED,OAAOC,EACHC,EAAO,QAAQ,kBAAmB,sBAAsB,EACxDA,CACN,OAASC,EAAO,CACd,OAAIH,EAAQ,cAAc,QAAQ,KAAKG,CAAK,EAErC,SACLF,EAAO,SAAW,EACpB,8BAA8BR,EAC3BU,EAAgB,SACnB,CAAA,CAAC,KAAKV,EAAWK,CAAG,CAAC,SACvB,CACF,EAEMM,EAAa,CACjBN,EACAC,EACAC,EACAC,IACW,CACX,GAAI,CACF,MAAO,MACLA,EAAO,SAAW,EACpB,uBAAuBF,EAAM,eAAeD,EAAK,CAC/C,GAAGE,EACH,YAAa,EACf,CAAC,CAAC;AAAA,CACJ,OAASG,EAAO,CACd,OAAIH,EAAQ,cAAc,QAAQ,KAAKG,CAAK,EAErC,MACLF,EAAO,SAAW,EACpB,0CAA0CR,EACvCU,EAAgB,SACnB,CAAA,CAAC,KAAKV,EAAWK,CAAG,CAAC;AAAA,CACvB,CACF,EAEaC,EAAQ,CACnBM,EACAL,EAAiD,KACxC,CACT,KAAM,CACJ,qBAAAM,EAAuB,GACvB,UAAAC,EAAY,GACZ,OAAAC,EAAS,GACT,OAAAC,EAAUC,GACRA,IAAc,uBAAyB,SAAW,OACpD,KAAAT,EAAO,GACP,GAAGU,CACL,EAAIX,EAEJ,GAAI,CACF,MAAMD,EAAsBJ,EAAQ,OAAO,EAEvCa,GAAQb,EAAQ,sBAAsB,EAE1CU,EAAG,IAAIP,EAAK,CACV,qBAAAQ,EACA,UAAAC,EACA,OAAQ,CAACK,EAAiBC,EAAsBC,IAAuB,CACrE,MAAMC,EAAe,CACnB,OAAQ,CACNL,EAOAM,EACAC,IACWR,EAAOC,EAAWM,EAAUC,EAAOH,CAAG,GAAK,SACxD,aAAc,GACd,GAAGH,CACL,EAEA,OAAOE,EACHT,EAAWQ,EAASb,EAAOgB,EAAcd,CAAI,EAC7CJ,EAAYe,EAASb,EAAOgB,EAAcd,CAAI,CACpD,CACF,CAAC,CACH,MAAc,CACZ,QAAQ,MAAM,mDAAmD,CACnE,CACF"}