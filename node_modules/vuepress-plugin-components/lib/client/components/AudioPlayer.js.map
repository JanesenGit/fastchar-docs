{"version":3,"file":"AudioPlayer.js","sources":["../../../src/client/components/AudioPlayer.ts"],"sourcesContent":["import type { Options as PlyrOptions } from \"plyr\";\nimport type { PropType, VNode } from \"vue\";\nimport { defineComponent, h, onBeforeMount, onMounted, shallowRef } from \"vue\";\n\nimport { getLink } from \"../utils/index.js\";\n\nimport \"plyr/dist/plyr.css\";\nimport \"../styles/audio-player.scss\";\n\nexport default defineComponent({\n  name: \"AudioPlayer\",\n\n  props: {\n    /** Options object for plyr config. **/\n    options: {\n      type: Object as PropType<PlyrOptions>,\n      default: () => ({}),\n    },\n\n    /**\n     * Audio source\n     *\n     * 音频源\n     */\n    src: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Audio title\n     *\n     * 音频标题\n     */\n    title: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Audio file type\n     *\n     * 音频文件类型\n     */\n    type: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Audio poster\n     *\n     * 音频封面\n     */\n    poster: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Component width\n     *\n     * 组件宽度\n     */\n    width: {\n      type: [String, Number],\n      default: \"100%\",\n    },\n\n    /**\n     * Whether to loop the video\n     *\n     * 是否循环播放\n     */\n    loop: Boolean,\n  },\n\n  setup(props) {\n    let player: Plyr | null = null;\n    const audio = shallowRef<HTMLAudioElement>();\n\n    onMounted(async () => {\n      const { default: Plyr } = await import(\n        /* webpackChunkName: \"plyr\" */ \"plyr\"\n      );\n\n      player = new Plyr(audio.value!, {\n        // @ts-ignore\n        hideYouTubeDOMError: true,\n        ...props.options,\n      });\n    });\n\n    onBeforeMount(() => {\n      try {\n        player?.destroy();\n      } catch (err: unknown) {\n        // Do nothing\n      }\n    });\n\n    return (): VNode =>\n      h(\n        \"div\",\n        {\n          class: \"vp-audio-player\",\n          style: {\n            width: props.width,\n          },\n        },\n        [\n          h(\"a\", {\n            class: \"sr-only\",\n            href: getLink(props.src),\n            innerHTML: props.title || \"An audio\",\n          }),\n          props.poster\n            ? h(\"img\", {\n                class: \"vp-audio-player-poster\",\n                src: getLink(props.poster),\n                loading: \"lazy\",\n                \"no-view\": \"\",\n              })\n            : null,\n          h(\"div\", { class: \"vp-audio-player-info\" }, [\n            props.title\n              ? h(\"div\", {\n                  class: \"vp-audio-player-title\",\n                  innerHTML: props.title,\n                })\n              : null,\n            h(\n              \"audio\",\n              {\n                ref: audio,\n                crossorigin: \"anonymous\",\n                preload: \"metadata\",\n                controls: \"\",\n                ...(props.loop ? { loop: \"\" } : {}),\n              },\n              h(\"source\", { src: getLink(props.src), type: props.type }),\n            ),\n          ]),\n        ],\n      );\n  },\n});\n"],"names":["AudioPlayer","defineComponent","props","player","audio","shallowRef","onMounted","Plyr","onBeforeMount","h","getLink"],"mappings":"iQASA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,cAEN,MAAO,CAEL,QAAS,CACP,KAAM,OACN,QAAS,KAAO,CAClB,EAAA,EAOA,IAAK,CACH,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,CACL,KAAM,OACN,QAAS,EACX,EAOA,KAAM,CACJ,KAAM,OACN,QAAS,EACX,EAOA,OAAQ,CACN,KAAM,OACN,QAAS,EACX,EAOA,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,KAAM,OACR,EAEA,MAAMC,EAAO,CACX,IAAIC,EAAsB,KAC1B,MAAMC,EAAQC,EAA6B,EAE3C,OAAAC,EAAU,SAAY,CACpB,KAAM,CAAE,QAASC,CAAK,EAAI,KAAM,QACC,MACjC,EAEAJ,EAAS,IAAII,EAAKH,EAAM,MAAQ,CAE9B,oBAAqB,GACrB,GAAGF,EAAM,OACX,CAAC,CACH,CAAC,EAEDM,EAAc,IAAM,CAClB,GAAI,CACFL,GAAQ,SACV,MAAuB,CAGzB,CAAA,CAAC,EAEM,IACLM,EACE,MACA,CACE,MAAO,kBACP,MAAO,CACL,MAAOP,EAAM,KACf,CACF,EACA,CACEO,EAAE,IAAK,CACL,MAAO,UACP,KAAMC,EAAQR,EAAM,GAAG,EACvB,UAAWA,EAAM,OAAS,UAC5B,CAAC,EACDA,EAAM,OACFO,EAAE,MAAO,CACP,MAAO,yBACP,IAAKC,EAAQR,EAAM,MAAM,EACzB,QAAS,OACT,UAAW,EACb,CAAC,EACD,KACJO,EAAE,MAAO,CAAE,MAAO,sBAAuB,EAAG,CAC1CP,EAAM,MACFO,EAAE,MAAO,CACP,MAAO,wBACP,UAAWP,EAAM,KACnB,CAAC,EACD,KACJO,EACE,QACA,CACE,IAAKL,EACL,YAAa,YACb,QAAS,WACT,SAAU,GACV,GAAIF,EAAM,KAAO,CAAE,KAAM,EAAG,EAAI,CAClC,CAAA,EACAO,EAAE,SAAU,CAAE,IAAKC,EAAQR,EAAM,GAAG,EAAG,KAAMA,EAAM,IAAK,CAAC,CAC3D,CACF,CAAC,CACH,CACF,CACJ,CACF,CAAC"}