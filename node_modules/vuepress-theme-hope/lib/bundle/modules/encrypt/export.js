import{defineComponent as m,ref as p,computed as d,h as s,nextTick as O,onMounted as E}from"vue";import{usePageFrontmatter as T,usePageData as k}from"vuepress/client";import{L as _}from"../../icons-BBxJRXot.js";import{u as w,a as x}from"../../useThemeData-BOFgq9MR.js";import{useStorage as h,useSessionStorage as b}from"@vueuse/core";import{compareSync as f}from"bcrypt-ts/browser";import{F as G}from"../../FadeSlideY-CObDh48J.js";import{isPlainObject as H,keys as K,startsWith as V}from"@vuepress/helper/client";import"vuepress-shared/client";import"@vuepress/plugin-theme-data/client";var g=m({name:"PasswordModal",props:{full:Boolean},emits:["verify"],setup(l,{emit:t}){const r=T(),n=w(),o=p(""),e=p(!1),a=p(!1),u=d(()=>n.value.encryptLocales);let i=null;const c=()=>{i&&clearTimeout(i),e.value=!1,t("verify",o.value,a.value),O().then(()=>{e.value=!0,i=setTimeout(()=>{e.value=!1},1e3)})};return()=>s("div",{class:["vp-decrypt-layer",{expand:l.full||r.value.home}]},s("div",{class:"vp-decrypt-modal"},[s("div",{class:["vp-decrypt-hint",{tried:e.value}]},e.value?u.value.errorHint:s(_,{"aria-label":u.value.iconLabel})),s("div",{class:"vp-decrypt-input"},[s("input",{type:"password",value:o.value,placeholder:u.value.placeholder,onInput:({target:v})=>{o.value=v.value},onKeydown:({key:v})=>{v==="Enter"&&c()}})]),s("div",{class:"vp-remember-password"},[s("input",{type:"checkbox",value:a.value,onChange:()=>a.value=!a.value}),u.value.remember]),s("button",{type:"button",class:"vp-decrypt-submit",onClick:()=>c()},"OK")]))}});const P=()=>{const l=x();return d(()=>l.value.encrypt||{})},S="VUEPRESS_HOPE_GLOBAL_TOKEN",j=()=>{const l=P(),t=h(S,""),r=b(S,""),n=d(()=>{const{global:e=!1,admin:a=[]}=l.value;return e&&a.length>0}),o=d(()=>{if(n.value){if(t.value)return l.value.admin.some(e=>f(t.value,e));if(r.value)return l.value.admin.some(e=>f(r.value,e))}return!1});return{isEncrypted:n,isDecrypted:o,validate:(e,a=!1)=>{(a?t:r).value=e}}},y=(l="",t)=>!!l&&f(l,t),D="VUEPRESS_HOPE_PATH_TOKEN",C=()=>{const l=k(),t=P(),r=h(D,{}),n=b(D,{}),o=a=>H(t.value.config)?K(t.value.config).filter(u=>V(decodeURI(a),u)).sort((u,i)=>i.length-u.length):[],e=a=>{const u=o(a);if(u.length>0){const{config:i={}}=t.value;return{isEncrypted:!0,isDecrypted:u.some(c=>r.value[c]&&i[c].some(v=>y(r.value[c],v))||n.value[c]&&i[c].some(v=>y(n.value[c],v)))}}return{isDecrypted:!1,isEncrypted:!1}};return{status:d(()=>e(l.value.path)),getStatus:e,validate:(a,u=!1)=>{const{config:i={}}=t.value,c=o(l.value.path);for(const v of c)if(i[v].filter(L=>y(a,L))){(u?r:n).value[v]=a;break}}}};var F=m({name:"GlobalEncrypt",slots:Object,setup(l,{slots:t}){const{isDecrypted:r,isEncrypted:n,validate:o}=j(),e=p(!1);return E(()=>{e.value=!0}),()=>s(G,()=>n.value?e.value?r.value?t.default():s(g,{full:!0,onVerify:o}):null:t.default())}}),I=m({name:"LocalEncrypt",slots:Object,setup(l,{slots:t}){const{status:r,validate:n}=C(),o=p(!1);return E(()=>{o.value=!0}),()=>{const{isEncrypted:e,isDecrypted:a}=r.value;return e?o.value?a?t.default():s(g,{full:!0,onVerify:n}):null:t.default()}}});export{F as GlobalEncrypt,I as LocalEncrypt};
//# sourceMappingURL=export.js.map
