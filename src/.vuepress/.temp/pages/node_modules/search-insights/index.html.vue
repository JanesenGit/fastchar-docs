<template><div><h1 id="search-insights" tabindex="-1"><a class="header-anchor" href="#search-insights" aria-hidden="true">#</a> Search Insights</h1>
<p><a href="https://github.com/algolia/search-insights.js" target="_blank" rel="noopener noreferrer"><img src="https://circleci.com/gh/algolia/search-insights.js.svg?style=shield" alt="Build Status"><ExternalLinkIcon/></a>
<a href="https://badge.fury.io/js/search-insights" target="_blank" rel="noopener noreferrer"><img src="https://badge.fury.io/js/search-insights.svg" alt="npm version"><ExternalLinkIcon/></a></p>
<p>Search Insights lets you report click, conversion and view metrics using the <a href="https://www.algolia.com/doc/rest-api/insights/#overview" target="_blank" rel="noopener noreferrer">Algolia Insights API<ExternalLinkIcon/></a>.</p>
<h2 id="table-of-contents" tabindex="-1"><a class="header-anchor" href="#table-of-contents" aria-hidden="true">#</a> Table of Contents</h2>
<!-- toc -->
<ul>
<li><a href="#getting-started">Getting started</a>
<ul>
<li><a href="#browser">Browser</a></li>
<li><a href="#nodejs">Node.js</a></li>
</ul>
</li>
<li><a href="#use-cases">Use cases</a>
<ul>
<li><a href="#search-click-analytics-and-ab-testing">Search (Click Analytics and A/B testing)</a></li>
<li><a href="#personalization">Personalization</a></li>
</ul>
</li>
<li><a href="#examples">Examples</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>
<!-- tocstop -->
<h2 id="cookie-usage" tabindex="-1"><a class="header-anchor" href="#cookie-usage" aria-hidden="true">#</a> Cookie usage</h2>
<p>You're looking at the documentation of <code v-pre>search-insights</code> v2, which is the new major version. (<em>Click <a href="https://github.com/algolia/search-insights.js/blob/v1/README.md" target="_blank" rel="noopener noreferrer">here<ExternalLinkIcon/></a> for v1.x documentation.</em>)</p>
<p>v2 introduces a breaking change which is <code v-pre>useCookie</code> being <code v-pre>false</code> by default. If it's <code v-pre>false</code>, <code v-pre>search-insights</code> doesn't generate anonymous userToken. It means no event will be sent until <code v-pre>setUserToken</code> is explicitly called.</p>
<h2 id="payload-validation" tabindex="-1"><a class="header-anchor" href="#payload-validation" aria-hidden="true">#</a> Payload validation</h2>
<p>Since v2.0.4, search-insights no longer validates event payloads.
You can visit https://algolia.com/events/debugger instead.</p>
<h2 id="getting-started" tabindex="-1"><a class="header-anchor" href="#getting-started" aria-hidden="true">#</a> Getting started</h2>
<blockquote>
<p>Are you using Google Tag Manager in your app? We provide a <a href="https://github.com/algolia/search-insights-gtm" target="_blank" rel="noopener noreferrer">custom template<ExternalLinkIcon/></a> to ease the integration.</p>
</blockquote>
<h3 id="browser" tabindex="-1"><a class="header-anchor" href="#browser" aria-hidden="true">#</a> Browser</h3>
<h4 id="_1-load-the-library" tabindex="-1"><a class="header-anchor" href="#_1-load-the-library" aria-hidden="true">#</a> 1. Load the library</h4>
<p>The Search Insights library can be either loaded via <a href="https://www.jsdelivr.com/" target="_blank" rel="noopener noreferrer">jsDelivr CDN<ExternalLinkIcon/></a> or directly bundled with your application.
We recommend loading the library by adding the snippet below to all pages where you wish to track search analytics.</p>
<!-- prettier-ignore-start -->
<div class="language-html line-numbers-mode" data-ext="html"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">var</span> <span class="token constant">ALGOLIA_INSIGHTS_SRC</span> <span class="token operator">=</span> <span class="token string">"https://cdn.jsdelivr.net/npm/search-insights@2.7.0"</span><span class="token punctuation">;</span>

<span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>a<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n<span class="token punctuation">,</span>s<span class="token punctuation">,</span>i<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>e<span class="token punctuation">.</span>AlgoliaAnalyticsObject<span class="token operator">=</span>s<span class="token punctuation">,</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token operator">=</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token operator">||</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">(</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>queue<span class="token operator">=</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>queue<span class="token operator">||</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>version<span class="token operator">=</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@([^\/]+)\/?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>i<span class="token operator">=</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>c<span class="token operator">=</span>a<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
i<span class="token punctuation">.</span>async<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token punctuation">.</span>src<span class="token operator">=</span>n<span class="token punctuation">,</span>c<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span>document<span class="token punctuation">,</span><span class="token string">"script"</span><span class="token punctuation">,</span><span class="token constant">ALGOLIA_INSIGHTS_SRC</span><span class="token punctuation">,</span><span class="token string">"aa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!-- prettier-ignore-end -->
<h4 id="_2-initialize-the-library" tabindex="-1"><a class="header-anchor" href="#_2-initialize-the-library" aria-hidden="true">#</a> 2. Initialize the library</h4>
<p>Initializing the library is optional, as you can specify the <a href="#sending-events-to-multiple-algolia-applications">credentials for each event</a> when sending them. This gives you the flexibility to manage your Algolia credentials on a per-event basis, without having to configure them upfront.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token comment">// Optional: configure default Algolia credentials for events</span>
<span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">'APP_ID'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">'SEARCH_API_KEY'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Optional: set the analytics user ID</span>
<span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'setUserToken'</span><span class="token punctuation">,</span> <span class="token string">'USER_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>appId</code></td>
<td><code v-pre>string</code></td>
<td>None</td>
<td>The identifier of your Algolia application.</td>
</tr>
<tr>
<td><code v-pre>apiKey</code></td>
<td><code v-pre>string</code></td>
<td>None</td>
<td>The search API key of your Algolia application.</td>
</tr>
<tr>
<td><code v-pre>userHasOptedOut</code></td>
<td><code v-pre>boolean</code></td>
<td><code v-pre>false</code></td>
<td>Whether to exclude users from analytics.</td>
</tr>
<tr>
<td><code v-pre>region</code></td>
<td><code v-pre>'de' | 'us'</code></td>
<td>Automatic</td>
<td>The DNS server to target.</td>
</tr>
<tr>
<td><code v-pre>host</code></td>
<td><code v-pre>string</code></td>
<td>None</td>
<td>The URL to route requests through before they're forwarded to Algolia.</td>
</tr>
<tr>
<td><code v-pre>useCookie</code></td>
<td><code v-pre>boolean</code></td>
<td><code v-pre>false</code></td>
<td>Whether to use cookie in browser environment. The anonymous user token will not be set if <code v-pre>false</code>. When <code v-pre>useCookie</code> is <code v-pre>false</code> and <code v-pre>setUserToken</code> is not called yet, sending events will throw errors because there is no user token to attach to the events.</td>
</tr>
<tr>
<td><code v-pre>cookieDuration</code></td>
<td><code v-pre>number</code></td>
<td><code v-pre>15552000000</code> (6 months)</td>
<td>The cookie duration in milliseconds.</td>
</tr>
<tr>
<td><code v-pre>userToken</code></td>
<td><code v-pre>string</code></td>
<td><code v-pre>undefined</code> (optional)</td>
<td>Initial userToken. When given, anonymous userToken will not be set.</td>
</tr>
<tr>
<td><code v-pre>partial</code></td>
<td><code v-pre>boolean</code></td>
<td><code v-pre>false</code></td>
<td>Whether to preserve previously passed options without redeclaring them.</td>
</tr>
</tbody>
</table>
<p>To update the client with new options, you can call <code v-pre>init</code> again.</p>
<p>By default, all previously passed options that you don't redefine are reset to their default setting, except for the <code v-pre>userToken</code>. To preserve previously passed options without redeclaring them, use the <code v-pre>partial</code> option.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">"init"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">"APP_ID"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">"SEARCH_API_KEY"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">region</span><span class="token operator">:</span> <span class="token string">"de"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">"init"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">"APP_ID"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">"SEARCH_API_KEY"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">partial</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `region` is still `"de"`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="note-for-require-js-users" tabindex="-1"><a class="header-anchor" href="#note-for-require-js-users" aria-hidden="true">#</a> Note for Require.js users</h5>
<p>When using <a href="https://requirejs.org/" target="_blank" rel="noopener noreferrer">Require.js<ExternalLinkIcon/></a>, the default UMD build might conflict and throw with a &quot;Mismatched anonymous define() modules&quot; message. This is a <a href="https://requirejs.org/docs/errors.html#mismatch" target="_blank" rel="noopener noreferrer">known Require.js issue<ExternalLinkIcon/></a>.</p>
<p>To work around this problem and ensure you capture all interactions occurring before the library is done loading, change <code v-pre>ALGOLIA_INSIGHTS_SRC</code> to point to the IIFE build, and load it via a <code v-pre>&lt;script&gt;</code> tag.</p>
<!-- prettier-ignore-start -->
<div class="language-html line-numbers-mode" data-ext="html"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">var</span> <span class="token constant">ALGOLIA_INSIGHTS_SRC</span> <span class="token operator">=</span> <span class="token string">"https://cdn.jsdelivr.net/npm/search-insights@2.7.0/dist/search-insights.iife.min.js"</span><span class="token punctuation">;</span>

<span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>a<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n<span class="token punctuation">,</span>s<span class="token punctuation">,</span>i<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>e<span class="token punctuation">.</span>AlgoliaAnalyticsObject<span class="token operator">=</span>s<span class="token punctuation">,</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token operator">=</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token operator">||</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">(</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>queue<span class="token operator">=</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>queue<span class="token operator">||</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>version<span class="token operator">=</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@([^\/]+)\/?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>i<span class="token operator">=</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>c<span class="token operator">=</span>a<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
i<span class="token punctuation">.</span>async<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token punctuation">.</span>src<span class="token operator">=</span>n<span class="token punctuation">,</span>c<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span>document<span class="token punctuation">,</span><span class="token string">"script"</span><span class="token punctuation">,</span><span class="token constant">ALGOLIA_INSIGHTS_SRC</span><span class="token punctuation">,</span><span class="token string">"aa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!-- prettier-ignore-end -->
<h3 id="node-js" tabindex="-1"><a class="header-anchor" href="#node-js" aria-hidden="true">#</a> Node.js</h3>
<p><em>(Node.js <code v-pre>&gt;= 8.16.0</code> required)</em></p>
<h4 id="_1-install-the-library" tabindex="-1"><a class="header-anchor" href="#_1-install-the-library" aria-hidden="true">#</a> 1. Install the library</h4>
<p>Insights library can be used on the backend as a Node.js module.</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> search-insights
<span class="token comment"># or</span>
<span class="token function">yarn</span> <span class="token function">add</span> search-insights
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-initialize-the-library-1" tabindex="-1"><a class="header-anchor" href="#_2-initialize-the-library-1" aria-hidden="true">#</a> 2. Initialize the library</h4>
<p>Initializing the library is optional, as you can specify the <a href="#sending-events-to-multiple-algolia-applications">credentials for each event</a> when sending them. This gives you the flexibility to manage your Algolia credentials on a per-event basis, without having to configure them upfront.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> aa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'search-insights'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Optional: configure default Algolia credentials for events</span>
<span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">'APPLICATION_ID'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">'SEARCH_API_KEY'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="add-usertoken" tabindex="-1"><a class="header-anchor" href="#add-usertoken" aria-hidden="true">#</a> Add <code v-pre>userToken</code></h4>
<p>On the Node.js environment, unlike the browser environment, <code v-pre>userToken</code> must be specified when sending any event.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'clickedObjectIDs'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">userToken</span><span class="token operator">:</span> <span class="token string">'USER_ID'</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="customize-the-client" tabindex="-1"><a class="header-anchor" href="#customize-the-client" aria-hidden="true">#</a> Customize the client</h4>
<p>If you want to customize the way to send events, you can create a custom Insights client.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token comment">// via ESM</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createInsightsClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"search-insights"</span><span class="token punctuation">;</span>
<span class="token comment">// OR in commonJS</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createInsightsClient <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"search-insights"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// OR via the UMD</span>
<span class="token keyword">const</span> createInsightsClient <span class="token operator">=</span> window<span class="token punctuation">.</span>AlgoliaAnalytics<span class="token punctuation">.</span>createInsightsClient<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">requestFn</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> serializedData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> protocol<span class="token punctuation">,</span> host<span class="token punctuation">,</span> path <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    protocol<span class="token punctuation">,</span>
    host<span class="token punctuation">,</span>
    path<span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"Content-Length"</span><span class="token operator">:</span> serializedData<span class="token punctuation">.</span>length
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">request</span><span class="token operator">:</span> nodeRequest <span class="token punctuation">}</span> <span class="token operator">=</span>
    url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"https://"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"https"</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> req <span class="token operator">=</span> <span class="token function">nodeRequest</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>serializedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> aa <span class="token operator">=</span> <span class="token function">createInsightsClient</span><span class="token punctuation">(</span>requestFn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="use-cases" tabindex="-1"><a class="header-anchor" href="#use-cases" aria-hidden="true">#</a> Use cases</h2>
<p>The Search Insights library supports both <a href="https://www.algolia.com/doc/guides/getting-insights-and-analytics/search-analytics/out-of-the-box-analytics/" target="_blank" rel="noopener noreferrer">Search<ExternalLinkIcon/></a> and <a href="https://www.algolia.com/doc/guides/getting-insights-and-analytics/personalization/personalization/" target="_blank" rel="noopener noreferrer">Personalization<ExternalLinkIcon/></a> Algolia features.</p>
<h3 id="search-click-analytics-and-a-b-testing" tabindex="-1"><a class="header-anchor" href="#search-click-analytics-and-a-b-testing" aria-hidden="true">#</a> Search (Click Analytics and A/B testing)</h3>
<h4 id="initialize" tabindex="-1"><a class="header-anchor" href="#initialize" aria-hidden="true">#</a> Initialize</h4>
<p>To enable click analytics, the search parameter <a href="https://www.algolia.com/doc/api-reference/api-parameters/clickAnalytics/" target="_blank" rel="noopener noreferrer"><code v-pre>clickAnalytics</code><ExternalLinkIcon/></a> must be set to <code v-pre>true</code>. This tells the Algolia engine to return a <code v-pre>queryID</code> on each search request.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> searchClient <span class="token operator">=</span> <span class="token function">algoliasearch</span><span class="token punctuation">(</span><span class="token string">'APPLICATION_ID'</span><span class="token punctuation">,</span> <span class="token string">'SEARCH_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> search <span class="token operator">=</span> <span class="token function">instantsearch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">indexName</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  searchClient<span class="token punctuation">,</span>
  <span class="token literal-property property">searchParameters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">clickAnalytics</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getQueryID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> search<span class="token punctuation">.</span>helper<span class="token punctuation">.</span>lastResults<span class="token punctuation">.</span>queryID<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="report-a-click-event" tabindex="-1"><a class="header-anchor" href="#report-a-click-event" aria-hidden="true">#</a> Report a click event</h4>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'clickedObjectIDsAfterSearch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Click item'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">queryID</span><span class="token operator">:</span> <span class="token function">getQueryID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">objectIDs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'object1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">positions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>index</code></td>
<td><code v-pre>string</code></td>
<td>The name of the index related to the event</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event</td>
</tr>
<tr>
<td><code v-pre>objectIDs</code></td>
<td><code v-pre>string[]</code></td>
<td>The list of IDs of the result that was clicked</td>
</tr>
<tr>
<td><code v-pre>positions</code></td>
<td><code v-pre>number[]</code></td>
<td>The list of the absolute positions of the HTML element that was clicked (1-based and <em>not</em> 0-based)</td>
</tr>
<tr>
<td><code v-pre>queryID</code></td>
<td><code v-pre>string</code></td>
<td>The <code v-pre>queryID</code> of the search sent from Algolia</td>
</tr>
</tbody>
</table>
<h4 id="report-a-conversion-event" tabindex="-1"><a class="header-anchor" href="#report-a-conversion-event" aria-hidden="true">#</a> Report a conversion event</h4>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'convertedObjectIDsAfterSearch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Add to basket'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">queryID</span><span class="token operator">:</span> <span class="token function">getQueryID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">objectIDs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'object1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>index</code></td>
<td><code v-pre>string</code></td>
<td>The name of the index related to the event</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event</td>
</tr>
<tr>
<td><code v-pre>objectIDs</code></td>
<td><code v-pre>string[]</code></td>
<td>The list of IDs of the result that was clicked</td>
</tr>
<tr>
<td><code v-pre>queryID</code></td>
<td><code v-pre>string</code></td>
<td>The <code v-pre>queryID</code> of the search sent from Algolia</td>
</tr>
</tbody>
</table>
<h3 id="personalization" tabindex="-1"><a class="header-anchor" href="#personalization" aria-hidden="true">#</a> Personalization</h3>
<h4 id="initialize-1" tabindex="-1"><a class="header-anchor" href="#initialize-1" aria-hidden="true">#</a> Initialize</h4>
<p>To enable personalization, the search parameter <a href="https://www.algolia.com/doc/api-reference/api-parameters/enablePersonalization/" target="_blank" rel="noopener noreferrer"><code v-pre>enablePersonalization</code><ExternalLinkIcon/></a> must be set to <code v-pre>true</code>.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> searchClient <span class="token operator">=</span> <span class="token function">algoliasearch</span><span class="token punctuation">(</span><span class="token string">'APPLICATION_ID'</span><span class="token punctuation">,</span> <span class="token string">'SEARCH_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> search <span class="token operator">=</span> <span class="token function">instantsearch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">indexName</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  searchClient<span class="token punctuation">,</span>
  <span class="token literal-property property">searchParameters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enablePersonalization</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="access-usertoken" tabindex="-1"><a class="header-anchor" href="#access-usertoken" aria-hidden="true">#</a> Access <code v-pre>userToken</code></h4>
<p>In cases where the <code v-pre>userToken</code> is generated, you need a way to access the <code v-pre>userToken</code> so that you can pass it to the <code v-pre>searchClient</code>.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> searchClient <span class="token operator">=</span> <span class="token function">algoliasearch</span><span class="token punctuation">(</span><span class="token string">'APPLICATION_ID'</span><span class="token punctuation">,</span> <span class="token string">'SEARCH_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'getUserToken'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> userToken</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// for algoliasearch v3.x</span>
  searchClient<span class="token punctuation">.</span><span class="token function">setExtraHeader</span><span class="token punctuation">(</span><span class="token string">'X-Algolia-UserToken'</span><span class="token punctuation">,</span> userToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// for algoliasearch v4.x</span>
  searchClient<span class="token punctuation">.</span>transporter<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'X-Algolia-UserToken'</span><span class="token punctuation">]</span> <span class="token operator">=</span> userToken<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="listen-to-usertoken-change" tabindex="-1"><a class="header-anchor" href="#listen-to-usertoken-change" aria-hidden="true">#</a> Listen to <code v-pre>userToken</code> change</h4>
<p>If you want to attach a listener for <code v-pre>userToken</code> change, you can call <code v-pre>onUserTokenChange</code>.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'onUserTokenChange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">userToken</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"userToken has changed: "</span><span class="token punctuation">,</span> userToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>onUserTokenChange</code> accepts <code v-pre>callback</code>(required) and <code v-pre>options</code>(optional).</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'onUserTokenChange'</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>immediate</code></td>
<td><code v-pre>boolean</code></td>
<td>Fire the callback as soon as it's attached</td>
</tr>
</tbody>
</table>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">,</span> <span class="token literal-property property">useCookie</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  This sets an anonymous user token if cookie is available.</span>

<span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'onUserTokenChange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">userToken</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// prints out the anonymous user token</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'setUserToken'</span><span class="token punctuation">,</span> <span class="token string">'my-user-id-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'onUserTokenChange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">userToken</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints out 'my-user-id-1'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With <code v-pre>immediate: true</code>, <code v-pre>onUserTokenChange</code> will be immediately fired with the token which is set beforehand.</p>
<h4 id="report-a-click-event-1" tabindex="-1"><a class="header-anchor" href="#report-a-click-event-1" aria-hidden="true">#</a> Report a click event</h4>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'clickedObjectIDs'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Add to basket'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">objectIDs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'object1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>index</code></td>
<td><code v-pre>string</code></td>
<td>The name of the index related to the event</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event</td>
</tr>
<tr>
<td><code v-pre>objectIDs</code></td>
<td><code v-pre>string[]</code></td>
<td>The list of IDs of the result that was clicked</td>
</tr>
</tbody>
</table>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'clickedFilters'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Filter on facet'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">filters</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'brand:Apple'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>index</code></td>
<td><code v-pre>string</code></td>
<td>The name of the index related to the event</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event</td>
</tr>
<tr>
<td><code v-pre>filters</code></td>
<td><code v-pre>string[]</code></td>
<td>The list of filters that was clicked as <code v-pre>'${attr}${op}${value}'</code></td>
</tr>
</tbody>
</table>
<h4 id="report-a-conversion-event-1" tabindex="-1"><a class="header-anchor" href="#report-a-conversion-event-1" aria-hidden="true">#</a> Report a conversion event</h4>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'convertedObjectIDs'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Add to basket'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">objectIDs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'object1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>index</code></td>
<td><code v-pre>string</code></td>
<td>The name of the index related to the event</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event</td>
</tr>
<tr>
<td><code v-pre>objectIDs</code></td>
<td><code v-pre>string[]</code></td>
<td>The list of IDs of the result that was clicked</td>
</tr>
</tbody>
</table>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'convertedFilters'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Filter on facet'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">filters</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'brand:Apple'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>index</code></td>
<td><code v-pre>string</code></td>
<td>The name of the index related to the event</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event</td>
</tr>
<tr>
<td><code v-pre>filters</code></td>
<td><code v-pre>string[]</code></td>
<td>The list of filters that was clicked as <code v-pre>'${attr}${op}${value}'</code></td>
</tr>
</tbody>
</table>
<h4 id="report-a-view-event" tabindex="-1"><a class="header-anchor" href="#report-a-view-event" aria-hidden="true">#</a> Report a view event</h4>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'viewedObjectIDs'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Add to basket'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">objectIDs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'object1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>index</code></td>
<td><code v-pre>string</code></td>
<td>The name of the index related to the event</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event</td>
</tr>
<tr>
<td><code v-pre>objectIDs</code></td>
<td><code v-pre>string[]</code></td>
<td>The list of IDs of the result that was clicked</td>
</tr>
</tbody>
</table>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'viewedFilters'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Filter on facet'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">filters</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'brand:Apple'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>index</code></td>
<td><code v-pre>string</code></td>
<td>The name of the index related to the event</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event</td>
</tr>
<tr>
<td><code v-pre>filters</code></td>
<td><code v-pre>string[]</code></td>
<td>The list of filters that was clicked as <code v-pre>'${attr}${op}${value}'</code></td>
</tr>
</tbody>
</table>
<h3 id="batch-events" tabindex="-1"><a class="header-anchor" href="#batch-events" aria-hidden="true">#</a> Batch Events</h3>
<p>You can send multiple events in a single HTTP request, by using <code v-pre>sendEvents</code> method.</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'sendEvents'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    eventType<span class="token punctuation">,</span>
    eventName<span class="token punctuation">,</span>
    userToken<span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>eventType</code></td>
<td><code v-pre>'view'</code> | <code v-pre>'click'</code> | <code v-pre>'conversion'</code></td>
<td>The name of the index related to the event.</td>
</tr>
<tr>
<td><code v-pre>eventName</code></td>
<td><code v-pre>string</code></td>
<td>The name of the event.</td>
</tr>
<tr>
<td><code v-pre>userToken</code></td>
<td><code v-pre>string</code> (optional)</td>
<td>search-insights uses anonymous user token or a token set by <code v-pre>setUserToken</code> method. You can override it by providing a <code v-pre>userToken</code> per event object.</td>
</tr>
</tbody>
</table>
<h3 id="sending-events-to-multiple-algolia-applications" tabindex="-1"><a class="header-anchor" href="#sending-events-to-multiple-algolia-applications" aria-hidden="true">#</a> Sending events to multiple Algolia applications</h3>
<p>The Search Insights library sends all events to the Algolia application it has been initialized with, by default. In some cases, you might have data coming from more than one Algolia application which all need events.</p>
<p>You can use a single instance of the Search Insights library while still customizing the Algolia credentials on a per-event basis. All click, view and conversion methods support an additional argument where you can specify credentials that will override those set during initialization (which is optional).</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'clickedObjectIDsAfterSearch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'INDEX_NAME'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'Click item'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">queryID</span><span class="token operator">:</span> <span class="token function">getQueryID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">objectIDs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'object1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">positions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'X-Algolia-Application-Id'</span><span class="token operator">:</span> <span class="token string">'OTHER_APP_ID'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'X-Algolia-API-Key'</span><span class="token operator">:</span> <span class="token string">'OTHER_SEARCH_API_KEY'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This also works with event batching, using <code v-pre>sendEvents</code>:</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token function">aa</span><span class="token punctuation">(</span><span class="token string">'sendEvents'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    eventType<span class="token punctuation">,</span>
    eventName<span class="token punctuation">,</span>
    userToken<span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'X-Algolia-Application-Id'</span><span class="token operator">:</span> <span class="token string">'OTHER_APP_ID'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'X-Algolia-API-Key'</span><span class="token operator">:</span> <span class="token string">'OTHER_SEARCH_API_KEY'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>headers</code></td>
<td><code v-pre>Record&lt;string, string&gt;</code></td>
<td>A dictionary of headers that will override those set by default. You can check out a list of headers for authentication in the <a href="https://www.algolia.com/doc/rest-api/insights/#authentication" target="_blank" rel="noopener noreferrer">Algolia API reference<ExternalLinkIcon/></a>.</td>
</tr>
</tbody>
</table>
<h2 id="examples" tabindex="-1"><a class="header-anchor" href="#examples" aria-hidden="true">#</a> Examples</h2>
<p>The following examples assume that the Search Insights library is loaded.</p>
<ul>
<li><a href="https://github.com/algolia/search-insights.js/blob/main/examples/INSTANTSEARCH.md" target="_blank" rel="noopener noreferrer">InstantSearch.js<ExternalLinkIcon/></a></li>
<li><a href="https://github.com/algolia/search-insights.js/blob/main/examples/HELPER.md" target="_blank" rel="noopener noreferrer">AlgoliaSearch Helper<ExternalLinkIcon/></a></li>
</ul>
<h2 id="contributing" tabindex="-1"><a class="header-anchor" href="#contributing" aria-hidden="true">#</a> Contributing</h2>
<p>To run the examples and the code, you need to run two separate commands:</p>
<ul>
<li><code v-pre>yarn dev</code> runs webpack and the Node.js server</li>
<li><code v-pre>yarn build:dev</code> runs Rollup in watch mode</li>
</ul>
<p>To release, go on <code v-pre>main</code> (<code v-pre>git checkout main</code>) and use:</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token function">yarn</span> run release
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>It will create a pull request for the next release. When it's reviewed, approved and merged, then CircleCI will automatically publish it to npm.</p>
<h2 id="license" tabindex="-1"><a class="header-anchor" href="#license" aria-hidden="true">#</a> License</h2>
<p>Search Insights is <RouterLink to="/node_modules/search-insights/LICENSE.html">MIT licensed</RouterLink>.</p>
</div></template>


